---
title: 安装飞鼠
description: 飞鼠的中心控制器和节点安装
published: true
date: 2023-10-20T13:58:15.248Z
tags: 
editor: markdown
dateCreated: 2023-09-25T12:41:31.836Z
---


# 1.前期准备工作
## 端口用途，
| 作用 | 类型 | 协议 | 备注 |
| --- | --- | --- | --- |
|网页访问     |  tcp | 8088        | master必开 |
|socket通信  |	tcp	| 8095        | master必开 |
|sdwan通信   |	udp	| 50000-51000 | master必开，路由节点、子网节点必开|

## 开启内核转发
编辑 /etc/sysctl.conf， 将
```
net.ipv4.ip_forward = 1  
net.ipv6.conf.all.forwarding = 1
```
添加并保存 然后 sysctl -p 使其生效。  
查看是否成功：`sysctl net.ipv4.ip_forward`
如果返回为“net.ipv4.ip_forward = 1”则表示成功 sysctl 
## 关闭防火墙
- 1.使用`systemctl stop ufw`关闭防火墙。
- 2.使用`sudo systemctl disable ufw`设置开机不启动防火墙
- 3.`sudo ufw status` 查看防火墙状态：inactive是关闭，active是开启

# 执行安装
分为中心控制器、路由节点、子网节点
- 中心控制器 ：完全有公网ip地址，用于控制所有节点通信转发
- 路由节点：可以是第二个数据中心要求有公网，用于冗余
- 子网节点：不要求公网，用于下级局域网之间通信
## 安装工具
需要提前安装docker、docker-compose;
## 安装中心控制器
粘贴compose.yaml文件，修改数据库设置为自己想要的密码，直接`docker-compose up -d`启动
```yaml
version: "3"
services:
 
  db:
    image: postgres:11-alpine
    environment:
      POSTGRES_DB: feishuwg
      POSTGRES_PASSWORD: m7576WDx8dunrjU2
      POSTGRES_USER: feishuuser
    logging:
      driver: "none"
    restart: unless-stopped
    ports:
     - 5432:5432/tcp 
    volumes:
      - /data/feishu/pg:/var/lib/postgresql/data
  feishu:
    image: feishuwg/wg:arm
    cap_add:
      - ALL
    depends_on:
      - db
    environment:
      #POSTGRE-PATH: postgres://数据库用户名:数据库密码@数据库所在内网地址:端口/库
      POSTGRE-PATH: postgres://feishuuser:m7576WDx8dunrjU2@localhost:5432/feishuwg
      NODE_TYPE: master
    restart: always
    network_mode: host
    volumes:
      - /data/feishu/feishudb:/feishu/db/
      - /lib/modules:/lib/modules
```
## 安装其他节点（节点类型在中心控制器添加节点时选择）
```yaml
version: "3"
services:
  feishu:
    image: feishuwg/wg:arm
    cap_add:
      - ALL
    environment:
      NODE_TYPE: slave
    restart: always
    network_mode: host
    volumes:
      - /data/feishu/feishudb:/feishu/db/
      - /lib/modules:/lib/modules
```

# 访问地址
https://ip:8088  
默认账号密码：`admin`,`admin@123!`